1. Выяснение требований:

* Цель -- увеличить продажи билетов
* Поддерживаются только события
* Событием можно считать однократное явление, которое происходит в течение некоторого времени, а затем перестает существовать.
* У события есть следующие атрибуты: доступно его текстовое описание, диапазон цен, местонахождение, дата, время и т.д.
* У нас нет набора данных с ручной разметкой. Чтобы построить обучающий набор, можно использовать данные о взаимодействиях пользователей с событиями.
* Нам доступна текущая геопозиция пользователя.
* Пользователи могут «подружиться» на платформе. Дружба является взаимной: то есть если пользователь A является другом B, то B также является другом A.
* Пользователи могут звать друг друга на события.
* События бывают платные и бесплатные
* На каждый месяц назначается около 1 миллиона событий.
* Около миллиона уникальных пользователей в день.
* Информацию о геопозиции получаем через посредников: Google Maps API и т.д.

Резюмируя требования:

Требуется спроектировать систему рекомендации событий, которая предоставляет каждому пользователю персонализированный список событий. После того как событие завершилось, пользователи не могут на него записаться. Кроме записи на события, пользователи могут приглашать на них друг друга и устанавливать отношения дружбы. Обучающие данные должны строиться в процессе эксплуатации на основе взаимодействий пользователей. Главная цель системы — увеличить продажи билетов.

2. Формулировка проблемы как задачи машинного обучения.

* Бизнес-цель -- увеличить продажи билетов.
* Определение входных и выходных данных системы: на вход система принимает данные пользователя, а на выходе возвращает первые k событий, ранжированных по релевантности для пользователя
* Выбор подходящей категории МО: эвристики ( рекомендовать, что сейчас популярно; модели на основе фильтрации ( коллаборативная или эмбединги ), ранжирование
 - На эвристиках можно выстроить базовое решение
 - Методы на основе МО, скорее всего, дадут более качественное решение. Присмотримся к категории LTR ( Learning To Rank )

 У LTR есть 3 категории: pointwise, pairwise, listwise ( точечное, попарное и списочное ранжирование )
Выбрал pointwise, так как легче организовать.

3. Подготовка данных.

* Доступны следующие данные: пользователи, события, отношения дружбы, взаимодействия.
* Пользователь хранит информацию о: ID пользователя; Имя пользователя; Возраст; Пол; Город; Страна; Язык; Часовой пояс
* События хранит информацию о: ID события; ID организатора; Категория; Подкатегория; Описание; Цена, Местонахождение, Дата и время.
* Друзья хранит информацию о : ID пользователя 1, ID пользователя 2, Временнáя метка
* Взаимодействия хранит информацию о: ID пользователя, ID события, Тип взаимодействия, Значение взаимодействия, Геопозиция ( широта; долгота ) 

* Конструирование признаков
 - местонахождение
 - время
 - социальный фактор
 - пользователь
 - событие

- Признаки местонахождения:
 - Легко ли добраться до места, где проводится событие? ( ранк от 0 до 100, где 90-100 транспорт не требуется, 70-89 просто добраться пешком, 50-69 возможно добраться пешком, 25–49 желателен транспорт, 0-24 необходим транспорт ) 
   - Сходство уровней пешей доступности ( сравниваем с событиями, на которые пользователь раньше записывался ( есть помеха в доступности или он на край света рванет ))
 - Насколько далеко находится место проведения события от места, где живет пользователь?
  - cовпадение страны и совпадение города
 - Устраивает ли расстояние пользователя?
  - Расстояние от дома пользователя до места проведения события. 

- Признаки времени:
 - Насколько удобно время, оставшееся до события?
  - Время, оставшееся до начала события.
  - Сходство оставшегося времени.
  - Оценочное время на дорогу
  - Сходство оценочного времени на дорогу
 - Насколько дата и время удобны для пользователя?

- Признаки, относящиеся к социальному фактору:
 - Сколько посетителей ожидается на событии?
 - События, которые посещают друзья
 - Был ли пользователь приглашен на событие другими пользователями?
 - Является ли организатор события другом пользователя?
 - Часто ли пользователь посещал предыдущие события этого организатора?

- Признаки пользователя:
 - Возраст и пол

- Признаки события:
 - Стоимость участия
 - Насколько похоже описание события на описания прежних событий, на которые записывался пользователь?

Дополнительные вопросы, не рассмотренные здесь: Статические и динамические признаки, Эффективное вычисление признаков, Коэффициент затухания, Обучение с эмбеддингами, Конструирование признаков на основе свойств пользователя может создавать смещение.

4. Разработка модели.
* Выбор модели: логрег, decision tree, градиентный бустинг, нейронная сеть
- Logistic regression:
 - Плюсы: высокая скорость вычисления, эффективное обучение, просто интерпретировать и понимать
 - Минусы: нельзя решать нелинейные задачи, мультиколлинеарность
- Дерево решений:
 - Плюсы: быстро обучаются, Быстрый результат, Мало затрат на подготовку данных, Интерпретируемость и простота понимания
 - Минусы: неоптимальная граница решений, переобучение
- Нейронная сеть:
 - Плюсы: подходит для непрерывного обучения, можем обрабатывать нелинейность данных
 - Минусы: вычислительно-затратное обучение, качество входных данных сильно влияет на результат, Эффект «черного ящика»
* Функция ошибок: кросс-энтропия

5. Оценка

* Оффлайн метрики:
 * Recall@k
 * Precision@k
 * MRR
 * nDCG
* Онлайн метрики: 
 * CTR
 * Конверсия
 * Закладочность
 * Рост выручки

6. Эксплуатация

* Пайплайн оперативного обучения: Источник данных -> Построение датасета -> Обучающий датасет -> Обучающий компонент -> Обученная модель МО -> Репозиторий моделей; паралелльно происходит оценка модели и её развертывание
* Предсказательный пайплайн

- Фильтрация событий: Компонент фильтрации событий принимает на вход данные о пользователе и сокращает количество событий с 1 миллиона до небольшой подборки. Его работа основана на простых правилах вроде места проведения событий или различных пользовательских фильтров. Например, если пользователь добавил фильтр «только концерты», компонент быстро сузит список до небольшого подмножества событий-кандидатов.
- Сервис ранжирования: Этот сервис принимает на вход пользователя и события-кандидаты, которые выработал компонент фильтрации, вычисляет признаки для каждой пары ⟨ пользователь, событие ⟩, сортирует события на основании вероятностей, предсказанных моделью, и выводит ранжированный список k самых релевантных событий для пользователя.
