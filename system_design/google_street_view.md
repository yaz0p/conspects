1. Выяснение требований:

* Примерная бизнес-цель -- защита конфиденциальности людей.
* Чтобы этого добиться, нужно спроектировать систему, которая обнаруживает лица, номерные знаки и размывает их.
* Пользователи должны уметь сообщать о недоработках системы.
* У нас есть вручную размеченный датасет.
* Проблема инференса у нас не стоит, так как пользователь смотрит на обработанные изображния, а не онлайн.

Резюмирую требования:

Итоговая бизнес-цель системы — защита конфиденциальности людей за счет размытия видимых номерных знаков и человеческих лиц на изображениях.

2. Формулировка проблемы как задачи машинного обучения

* Цель: точно обнаруживать на изображении объекты, которые представляют интерес.
Если система МО сможет точно обнаруживать эти объекты, к ним можно будет применить размытие перед тем, как показывать изображения пользователям.
* Определение выходных и выходных данных: на вход модели обнаружения объектов поступает изображение с некоторым количеством (ноль или более) объектов, которые находятся в разных местах. Модель обнаруживает эти объекты и выводит их расположение.
* Выходные данные модели: координаты целевых объектов

2.1 Выбор подходящей категории МО:
В общем случае у системы обнаружения объектов две задачи: 
- Предсказывать расположение каждого объекта на изображении;
- Предсказывать класс для каждой ограничительной рамки (например, «собака», «кошка» и т. д.).
Первая задача — это регрессия, потому что расположение можно выразить числовыми координатами (x, y).
Вторую задачу можно сформулировать как многоклассовую классификацию.
Сейчас можно решать на трансформерах (DETR, CoLa, LLaVa и т.д.)

Двуступенчатые подходы:
Сеть обнаружения регионов (RPN) -> Классификатор
К распространенным двухступенчатым сетям относятся R-CNN, Fast R-CNN и Faster R-CNN.

Одноступенчатые подходы:
YOLO и SSD

3. Подготовка данных.

* Доступны следующие данные: размеченный датасет, изображения из Street View.
* В размеченном датасете приведена следующая информация: объект, ограничительная рамка ( лицо, [10, 10, 25, 50] )
* Изображения Street View: изображения с объектами и метаданные (угол, тангаж, рысканье, геопозиция для поиск и т.п.)
* Конструирование признаков: сперва предобработка ( изменение размеров и нормализация ), а после -- аугментация.
* Аугментация: случайная обрезка; случайное изменение насыщенности; отражение по вертикали или горизонтали; поворот и/или смещение; аффинные преобразования; изменение яркости, насыщенности или контраста.

4. Разработка модели.

* Для решения этой задачи я выбираю двуступенчатый подход ( одноступенчатые были показаны выше ). 
Для этого подойдет сверточная нейронная сеть + RPN ( сеть обнаружения регионов ) + классификатор.
* Для обучения модели для определения границ объектов использую MSE, а для классификации кросс-энтропия

5. Оценка.

* Оффлайн метрики:
 * точность: количество обнаруженных объектов с планкой IOU >= заданного значения на общее количество обнаружений
 * средняя точность: либо интеграл, либо среднее по 11 порогам [0, 1, 0.1] 
 * усредненная средняя точность: средняя точность на количество классов; позволяет определить эффективность системы в общем смысле.
* Онлайн метрики:
 * Количество обращений пользователей и операторов: если их мало -- все хорошо.

6. Эксплуатация.

RPN предлагает на один объект несколько ограничительных прямоугольник, с высокой степенью перекрытия
В процессе анализа их необходимо сократить до одного. Для этого часто применяется алгоритм NMS (Non-Maximum Suppression, «подавление не-максимумов»)
NMS — алгоритм постобработки, который отбирает наиболее подходящие ограничительные прямоугольники. Он оставляет ограничительные прямоугольники с высоким уровнем достоверности и устраняет перекрытия.

* Пайплайн:
 * Предварительная обработка: этот компонент предварительно обрабатывает «сырые» изображения.
 * Сервис размытия: Этот компонент обрабатывает каждое изображение Street View таким образом:
  * Формирует список объектов, которые обнаружены на изображении.
  * Очищает список обнаруженных объектов с помощью NMS.
  * Размывает обнаруженные объекты.
  * Сохраняет изображение с размытием в хранилище объектов (изображения Street View с размытием).


Important links: 
* https://viso.ai/deep-learning/object-detection/
