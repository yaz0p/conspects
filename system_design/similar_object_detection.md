1. Выяснение требований:

* Бизнес-цель — увеличить количество бронирований
* Два объекта считаются похожими, если они находятся недалеко друг от друга, принадлежат одному диапазону цен и т. д.
* На платформе доступно пять миллионов объектов
* Будут использоваться только взаимодействия пользователей с объектами. Пускай модель не использует ни атрибуты пользователей (такие, как возраст или местонахождение), ни атрибуты объекта (например, цену и местонахождение).

Резюмируя требования:

Требуется спроектировать функциональность похожих объектов для платформы кратковременной аренды жилья. На вход принимается конкретный объект, который сейчас просматривает пользователь, а на выходе генерируется ранжированный список похожих объектов, по которым пользователь с большой вероятностью будет кликать. Система должна рекомендовать одни и те же объекты и анонимным, и авторизованным пользователям. На платформе доступно 5 миллионов предложений, и новые предложения могут начать появляться в рекомендациях через день после размещения. Бизнес-цель системы — повысить количество бронирований.

2. Формулировка проблемы в виде задачи МО

* Цель: точно предсказывать, по какому следующему объекту пользователь кликнет, исходя из того, какой объект он просматривает сейчас.
* Определение входных и выходных данных системы: на вход подается объект -- на выходе список из отранжированных похожих объектов
* Выбор категории машинного обучения: 
- Сессионные рекомендательные системы:
 - Сессионная (session-based) рекомендательная система стремится предсказать следующий элемент по серии последних элементов, которые просмотрел пользователь. В нашей системе интересы пользователя зависят от контекста и быстро меняются. Хорошие рекомендации больше опираются на последние взаимодействия пользователя, чем на его общие интересы.
- Традиционные рекомендательные системы: В традиционных рекомендательных системах интересы пользователей не зависят от контекста и меняются не очень часто. В сессионных системах интересы динамичны и быстро меняются. Традиционная система изучает общие интересы пользователей, а сессионная пытается понять их краткосрочные интересы на основе недавней истории просмотра.

- Чтобы разработать сессионную рекомендательную систему, обычно рассматривают эмбеддинги элементов и анализируют, какие элементы встречаются совместно в истории просмотра пользователей. Например, Instagram анализирует эмбеддинги учетных записей пользователей для функции Explore, Airbnb анализирует эмбеддинги объектов для поиска похожих объектов, а Word2vec использует аналогичный подход, чтобы обучаться содержательным эмбеддингам слов.

3. Подготовка данных

В системе доступны следующие данные: пользователи, объекты, взаимодействия пользователей с объектами.

* Пользователь хранит информацию о: ID пользователя; Имя пользователя; Возраст; Пол; Город; Страна; Язык; Часовой пояс
* Объект хранит информацию о атрибуты каждого объекта: цена, количество спальных мест, идентификатор собственника и т. д. Пример: ID объекта, ID арендодателя, Цена, Площадь (кв. м), Рейтинг, Тип, Город, Спальные места, Макс. кол-во гостей
* Взаимодействия пользователей с объектами хранит информацию о: ID взаимодействия, ID пользователя, ID объекта, Позиция объекта в списке, Тип взаимодействия, Источник, Временнáя метка

* Конструирование признаков:
- Во время обучения модель использует только историю просмотра пользователей и не задействует другую информацию — цену, возраст пользователя и т. д., то есть, сеансом поиска.
Выглядит сеанс примерно так: ID сеанса ID просмотренных объектов ID забронированного объекта

4. Разработка модели

* Выберу нейронную сеть для работы с эмбедингами сессии

* Обучение начинается с того, что эмбеддинги инициализируются случайными векторами. Модель постепенно обучается на этих векторах, просматривая сеансы поиска методом скользящего окна. При скольжении эмбеддинг центрального объекта в окне обновляется так, чтобы он стал похож на другие эмбеддинги в этом же окне и не был похож на эмбеддинги за его пределами. Затем модель использует эти эмбеддинги, чтобы предсказывать контекст заданного объекта.
Чтобы адаптировать модель к новым объектам, мы ежедневно обучаем ее на вновь сконструированных обучающих данных.

* Построение датасета: будет выбран
метод отрицательной выборки [4], который часто применяют для обучения
с эмбеддингами.
Чтобы построить обучающие данные, мы создаем положительные и отрицательные пары на основе сеансов поиска. Положительные пары — это объекты, у которых должны быть похожие эмбеддинги, тогда как в отрицательных парах эмбеддинги должны различаться. Выражаясь точнее, для каждого сеанса модель считывает объекты методом скользящего окна. По мере скольжения создаются положительные пары из центрального объекта в окне и объектов из его контекста. Отрицательные пары образуются из центрального объекта и случайно выбранных объектов вне его контекста. Положительным парам присваивается эталонная метка 1, а отрицательным — 0.

* Выбор функции потерь: кроссэнтропия, триплетлосс

5. Оценка

* Оффлайн метрики:
 * Средний ранг забронированного объекта
* Онлайн метрики: 
 * CTR
 * Сессионная доля бронирований

6. Эксплуатация

* Обучающий пайплайн: дообучаем модель на новых данных ( новые объекты и взаимодействие с ними пользователей )
* Индексирующий пайплайн: сохраняем все эмбединги и индексируем их, чтобы ускорить предсказательный пайплайн
* Предсказательный пайплайн: сервис выборки эмбеддингов; сервис поиска ближайшего соседа; сервис повторного ранжирования.

- Сервис выборки эмбеддингов: Этот сервис принимает на вход текущий просматриваемый объект и действует по-разному в зависимости от того, обработала ли его модель во время обучения.
- Сервис поиска ближайшего соседа: Чтобы рекомендовать похожие объекты, нужно вычислить степень сходства между эмбеддингом текущего просматриваемого объекта и эмбеддингами других объектов на платформе. Именно этим занимается сервис поиска ближайшего соседа. Этот сервис вычисляет степени сходства и выводит объекты, которые являются ближайшими соседями в пространстве эмбеддингов.
- Сервис повторного ранжирования: Этот сервис модифицирует подборку объектов, применяя пользовательские фильтры и некоторые ограничения. Например, сервис исключает объект, если он выходит за границу пользовательского фильтра цен. Кроме того, из подборки также могут быть удалены объекты в городах, которые не совпадают с городом текущего просматриваемого предложения.
